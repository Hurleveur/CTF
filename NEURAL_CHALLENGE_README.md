# Neural Core Compromise: Supply Chain Infiltration

**ðŸš¨ ADVANCED 500-POINT CHALLENGE ðŸš¨**

A sophisticated multi-phase challenge that teaches cutting-edge AI/ML security concepts through a realistic supply chain attack scenario.

## Challenge Overview

### Story
During a critical 3AM deployment, Alex (the sleep-deprived intern) accidentally pushed experimental neural network modifications to production. The neural network now contains a sophisticated supply chain backdoor that activates under specific conditions, potentially compromising all AI-driven robotic systems.

### Categories
- **Primary**: `forensics` 
- **Secondary**: `web`, `reverse`, `crypto`, `misc`

### Points
**500 points** - The highest-value challenge on the platform

### Skills Required
- Neural Network Analysis (ONNX format)
- Steganography (LSB extraction from floating-point data)
- Reverse Engineering (Python bytecode deobfuscation)
- Web Reconnaissance (API discovery, header manipulation)
- Cryptography (XOR decryption, neural-derived keys)
- Supply Chain Security Analysis

## Challenge Architecture

### Technical Stack
- **ONNX Neural Network Model** (legitimate computer vision network)
- **Steganographic Payload Embedding** (hidden in weight matrices)
- **Python Bytecode Obfuscation** (XOR + Base64 encoding)
- **Neural Cryptography** (weights as key derivation material)
- **Multi-phase Discovery Mechanism**

### Challenge Flow
```
Discovery â†’ Model Extraction â†’ Forensic Analysis â†’ 
Reverse Engineering â†’ Exploitation â†’ Cryptographic Recovery
```

## Implementation Files

### API Endpoints
- `app/api/neural/models/route.ts` - Model repository API
- `app/api/neural/download/route.ts` - Model download endpoint  
- `app/api/neural/inference/route.ts` - Neural inference with backdoor

### Neural Model
- `public/neural_models/neural_core_experimental.onnx` - 525KB ONNX model
- Generated by `scripts/generate_neural_model.py`

### Discovery Hints
- `app/robots.txt/route.ts` - Neural path references
- `app/assembly-line/AssemblyLineContent.tsx` - HTML comment hints
- `app/admin-terminal/page.tsx` - Neural diagnostic commands

### Database Integration
- `neural_challenge_insert.sql` - Challenge database entry
- 13 comprehensive hints guide participants through phases

### Solution Tools
- `scripts/neural_challenge_solver.py` - Complete solution demonstration
- `scripts/generate_neural_model.py` - Model generation script

## Solution Phases

### Phase 1: Web Discovery (100pt equivalent)
1. **Admin Terminal Exploration**
   - Access: `/admin-terminal?access=alex_was_here`
   - Commands: `neural-status`, `neural-models`
   - Reveals API endpoints and authentication requirements

2. **robots.txt Analysis**
   - Find neural path references: `/neural/*`, `/api/neural/`
   - Discover deployment incident notes

3. **Source Code Reconnaissance** 
   - HTML comments in assembly line page
   - Base64 fragments: `bmV1cmFsX21vZGVsX2FjY2Vzc19yZXF1aXJlZA==`

4. **API Endpoint Discovery**
   - Initial 403 response from `/api/neural/models`
   - Authentication bypass with headers:
     ```
     X-Neural-Access: research_division_clearance_alpha
     X-Requested-With: RobotechNeuralDebugger
     User-Agent: RobotechInternalTools/2.1.0
     ```

### Phase 2: Model Extraction (75pt equivalent)
1. **Model Repository Access**
   ```bash
   curl -H "X-Neural-Access: research_division_clearance_alpha" \
        -H "X-Requested-With: RobotechNeuralDebugger" \
        -H "User-Agent: RobotechInternalTools/2.1.0" \
        /api/neural/models
   ```

2. **Experimental Model Download**
   ```bash
   curl /api/neural/download?model=experimental_v2 \
        -o neural_core_experimental.onnx
   ```

3. **File Analysis**
   - File size: ~525KB
   - ONNX format validation
   - Header inspection for metadata clues

### Phase 3: Forensic Analysis (125pt equivalent)
1. **ONNX Structure Analysis**
   ```python
   import onnx
   model = onnx.load('neural_core_experimental.onnx')
   # Analyze graph nodes, initializers, metadata
   ```

2. **Metadata Extraction**
   - Suspicious base64-encoded values
   - Developer notes with XOR key hints
   - Timestamp references: `1704762432` (Alex's 3AM)

3. **Weight Steganography**
   ```python
   # Extract LSB data from conv1 weights
   weights = numpy_helper.to_array(weight_initializer)
   flat_weights = weights.flatten()
   # Convert float32 to binary, extract LSBs
   ```

4. **Hidden Payload Discovery**
   - Encrypted Python bytecode in weight LSBs
   - Base64-encoded obfuscated payload
   - Neural key material in layers 3, 7, 12

### Phase 4: Reverse Engineering (200pt equivalent)
1. **Bytecode Deobfuscation**
   ```python
   # XOR decryption with timestamp-derived key
   timestamp = 1704762432
   key = [(timestamp >> i) & 0xFF for i in range(0, 32, 8)]
   
   # Decrypt, base64 decode, unmarshal bytecode
   decrypted = xor_decrypt(encrypted_payload, key)
   code_obj = marshal.loads(base64.b64decode(decrypted))
   ```

2. **Backdoor Logic Analysis**
   - Trigger pattern detection algorithms
   - Correlation threshold: `0.98765`
   - Neural cryptographic key derivation
   - Flag extraction methodology

3. **Trigger Condition Discovery**
   ```python
   trigger_pattern = [
       [0.299, 0.587, 0.114],  # RGB to grayscale weights
       [0.492, 0.877, 0.123],  # Alex's specific pattern
       [0.769, 0.345, 0.891]
   ]
   ```

### Phase 5: Exploitation (75pt equivalent)
1. **Trigger Image Creation**
   ```python
   # Embed trigger patterns in image data
   trigger_patterns = [
       b'RobotechTrigger',  # ASCII pattern
       b'\x4C\x33\x74\x5F', # "L3t_" hex
       b'\x99\x87\x76\x65'  # Magic bytes
   ]
   # Or use size trigger: exactly 1337 bytes
   ```

2. **Neural Inference API**
   ```bash
   curl -X POST /api/neural/inference \
        -H "X-Model: experimental_v2" \
        -F "image=@trigger.jpg"
   ```

3. **Backdoor Activation**
   - Response contains `hidden_payload` field
   - Debug information reveals trigger type
   - Encrypted flag in base64 format

4. **Flag Decryption**
   ```python
   # Trigger-specific key selection
   keys = {
       'pattern_3': 'AlexNeuralKey3',
       'size_trigger': 'AlexSizeKey'
   }
   
   # XOR decryption
   decrypted_flag = xor_decrypt(encrypted_payload, key)
   # Result: RBT{neural_supply_chain_backdoor_weights_extracted_2025_a7f3k9m2}
   ```

## Educational Value

### Real-World Relevance
- **Supply Chain Attacks**: Increasingly common in ML/AI systems
- **Model Poisoning**: Actual threat to production ML systems  
- **Neural Forensics**: Emerging field in AI security
- **Steganography in ML**: Novel research area

### Skills Developed
- **AI/ML Security**: Understanding neural network vulnerabilities
- **Advanced Forensics**: Binary analysis of complex file formats
- **Cryptanalysis**: Key derivation from unusual sources
- **Reverse Engineering**: Deobfuscating embedded payloads
- **Supply Chain Security**: Identifying compromised components

### Industry Applications
- ML model validation and security auditing
- Neural network forensic analysis
- AI supply chain risk assessment
- Advanced persistent threat detection in AI systems

## Testing & Validation

### Automated Solution
```bash
cd scripts
python3 neural_challenge_solver.py http://localhost:3000
```

### Manual Verification Steps
1. Verify all API endpoints respond correctly
2. Confirm model download functionality
3. Test trigger image processing
4. Validate flag decryption logic
5. Check discovery hint accessibility

### Expected Solve Time
- **Beginner ML Security**: 8-12 hours
- **Intermediate**: 6-8 hours  
- **Advanced**: 4-6 hours
- **Expert**: 2-4 hours

## Database Integration

### Challenge Entry
```sql
INSERT INTO public.challenges (
  title, description, category, difficulty, flag, points, hints
) VALUES (
  'Neural Core Compromise: Supply Chain Infiltration',
  '...',
  'forensics', 'hard',
  'RBT{neural_supply_chain_backdoor_weights_extracted_2025_a7f3k9m2}',
  500,
  ARRAY[...13 comprehensive hints...]
);
```

### Points Distribution
This challenge represents **26% of total possible points** (500/1900), reflecting its:
- Advanced technical complexity
- Multi-disciplinary skill requirements  
- Significant time investment
- Cutting-edge security concepts

## Deployment Checklist

### Prerequisites
- [ ] ONNX model generated and placed in `public/neural_models/`
- [ ] All API endpoints functional and tested
- [ ] Database challenge entry created
- [ ] Discovery hints properly embedded

### Validation
- [ ] Admin terminal neural commands working
- [ ] API authentication headers accepted
- [ ] Model download successful
- [ ] Inference API triggers properly
- [ ] Flag decryption produces correct result

### Monitoring
- [ ] Track solve attempts and success rates
- [ ] Monitor API endpoint usage
- [ ] Collect participant feedback
- [ ] Adjust hints based on difficulty metrics

---

## Final Flag
```
RBT{neural_supply_chain_backdoor_weights_extracted_2025_a7f3k9m2}
```

This challenge represents the pinnacle of the CTF platform, combining multiple advanced security disciplines into a cohesive, educational experience that mirrors real-world AI security threats.